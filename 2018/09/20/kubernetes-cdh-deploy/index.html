<!DOCTYPE html>
<html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <title>kubernetes 部署cdh 通过 NASNFS）进行文件存储。 &mdash; 张建新</title>
      <!-- or -->

    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <link rel="stylesheet" href="http://112firshme11224.test.upcdn.net/assets/vendor/primer-css/css/primer.css">
    <link rel="stylesheet" href="http://112firshme11224.test.upcdn.net/assets/vendor/primer-markdown/dist/user-content.min.css">
    <link rel="stylesheet" href="http://112firshme11224.test.upcdn.net/assets/vendor/octicons/octicons/octicons.css">
    <link rel="stylesheet" href="http://112firshme11224.test.upcdn.net/assets/css/components/collection.css">
    <link rel="stylesheet" href="http://112firshme11224.test.upcdn.net/assets/css/components/repo-card.css">
    <link rel="stylesheet" href="http://112firshme11224.test.upcdn.net/assets/css/sections/repo-list.css">
    <link rel="stylesheet" href="http://112firshme11224.test.upcdn.net/assets/css/sections/mini-repo-list.css">
    <link rel="stylesheet" href="http://112firshme11224.test.upcdn.net/assets/css/components/boxed-group.css">
    <link rel="stylesheet" href="http://112firshme11224.test.upcdn.net/assets/css/globals/common.css">
    <link rel="stylesheet" href="http://112firshme11224.test.upcdn.net/assets/vendor/share.js/dist/css/share.min.css">
    <link rel="stylesheet" href="http://112firshme11224.test.upcdn.net/assets/css/globals/responsive.css">
    <link rel="stylesheet" href="http://112firshme11224.test.upcdn.net/assets/css/posts/index.css">
    <!-- Latest compiled and minified CSS -->
    

    
    <link rel="canonical" href="https://firsh.me/2018/09/20/kubernetes-cdh-deploy/">
    <link rel="alternate" type="application/atom+xml" title="张建新" href="/feed.xml">
    <link rel="shortcut icon" href="/favicon.ico">
    
    <meta property="og:title" content="kubernetes 部署cdh 通过 NASNFS）进行文件存储。">
      
    <meta name="keywords" content="hadoop cdh kubernetes">
    <meta name="og:keywords" content="hadoop cdh kubernetes">
      
    <meta name="description" content="技术验证篇，通过Kubernetes搭建一个可扩展的 CDH，并且启动hadoop。">
    <meta name="og:description" content="技术验证篇，通过Kubernetes搭建一个可扩展的 CDH，并且启动hadoop。">
      
    
    
        
    
    <meta property="og:url" content="https://firsh.me/2018/09/20/kubernetes-cdh-deploy/">
    <meta property="og:site_name" content="张建新">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="zh_CN" />
    
    <meta property="article:published_time" content="2018-09-20">
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-3969253077255521",
              enable_page_level_ads: true
         });
    </script>
    <script async custom-element="amp-auto-ads"
            src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    <script src="http://112firshme11224.test.upcdn.net/assets/vendor/jquery/dist/jquery.min.js"></script>
    <script src="http://112firshme11224.test.upcdn.net/assets/js/jquery-ui.js"></script>
    <script type="text/javascript">
    function toggleMenu() {
        var nav = document.getElementsByClassName("site-header-nav")[0];
        if (nav.style.display == "inline-flex") {
          nav.style.display = "none";
        } else {
          nav.style.display = "inline-flex";
        }
    }
    </script>
</head>
<body class="" data-mz="">
    <header class="site-header">
        <div class="container">
            <h1><a href="/" title="张建新"><span class="octicon octicon-mark-github"></span> 张建新</a></h1>
            <button class="collapsed mobile-visible" type="button" onclick="toggleMenu();">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <nav class="site-header-nav" role="navigation">
                
                <a href="/" class=" site-header-nav-item" target="" title="首页">首页</a>
                
                <a href="/categories/" class=" site-header-nav-item" target="" title="分类">分类</a>
                
                <a href="/wiki/" class=" site-header-nav-item" target="" title="维基">维基</a>
                
                <a href="/links/" class=" site-header-nav-item" target="" title="链接">链接</a>
                
                <a href="/about/" class=" site-header-nav-item" target="" title="关于">关于</a>
                
            </nav>
        </div>
    </header>
    <!-- / header -->

    <section class="collection-head small geopattern" data-pattern-id="kubernetes 部署cd">
<div class="container">
  <div class="columns">
    <div class="column three-fourths">
      <div class="collection-title">
        <h1 class="collection-header">kubernetes 部署cdh 通过 NASNFS）进行文件存储。</h1>
        <div class="collection-info">
          
          <span class="meta-info">
            <span class="octicon octicon-calendar"></span> 2018/09/20
          </span>
          
          
          <span class="meta-info">
            <span class="octicon octicon-file-directory"></span>
            <a href="/categories/#cdh" title="cdh">cdh</a>
          </span>
          
        </div>
      </div>
    </div>
  </div>
</div>
</section>
<!-- / .banner -->
<section class="container content">
<div class="columns">
  <div class="column three-fourths" >
    <article class="article-content markdown-body">
    <p>技术验证篇，通过Kubernetes搭建一个可扩展的 CDH，并且启动hadoop。</p>

<h2 id="quick">Quick</h2>

<ul>
  <li>主要用到<code class="language-plaintext highlighter-rouge">Kubernetes</code> 阿里云</li>
  <li>镜像来源 <code class="language-plaintext highlighter-rouge">https://github.com/windawings/spot-docker</code> .</li>
  <li>启动文件.<code class="language-plaintext highlighter-rouge">yaml</code>文件</li>
  <li>NAS 阿里云弹性存储 NAS</li>
</ul>

<h2 id="注意">注意</h2>
<ul>
  <li>NAS 需要开启<code class="language-plaintext highlighter-rouge">VPC</code>网络安全组</li>
  <li>镜像需要上传到自己的私有仓库</li>
  <li>
    <p>Kubernetes 下载镜像需要配置<code class="language-plaintext highlighter-rouge">yaml &lt;&lt; imagePullSecrets</code>,文章结尾会将<code class="language-plaintext highlighter-rouge">yaml</code>奉上</p>
  </li>
  <li>Kubernetes默认会创建一个<code class="language-plaintext highlighter-rouge">SLB</code>（用来给Ingress 使用)，我们用来暴露CDH的<code class="language-plaintext highlighter-rouge">UI</code>就是需要采用 <code class="language-plaintext highlighter-rouge">Ingress</code> 来进行暴露。</li>
  <li><code class="language-plaintext highlighter-rouge">Ingress</code> 所在 <code class="language-plaintext highlighter-rouge">Namespace = kube-system</code></li>
</ul>

<p><img src="http://112firshme11224.test.upcdn.net/demos/17612368-36b7-49c3-bcbd-6bd7848c849a.png" alt="" /></p>

<ul>
  <li>域名解析 注意是<code class="language-plaintext highlighter-rouge">泛域名</code></li>
</ul>

<h2 id="开始部署">开始部署</h2>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">cloudera-sa</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">cloudera</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">sa</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
<span class="na">automountServiceAccountToken</span><span class="pi">:</span> <span class="no">true</span>
<span class="nn">---</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRole</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">cloudera</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">cloudera-cr</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">cr</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
<span class="na">rules</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">*"</span><span class="pi">]</span>
  <span class="na">resources</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">*"</span><span class="pi">]</span>
  <span class="na">verbs</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">*"</span><span class="pi">]</span>
<span class="pi">-</span> <span class="na">nonResourceURLs</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">*"</span><span class="pi">]</span>
  <span class="na">verbs</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">*"</span><span class="pi">]</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRoleBinding</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">cloudera-crb</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">cloudera</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">crb</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
<span class="na">subjects</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">cloudera-sa</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">cloudera</span>
<span class="na">roleRef</span><span class="pi">:</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRole</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">cloudera-cr</span>
  <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">cloudera-config</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">cloudera</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">cloudera-config</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">master_host</span><span class="pi">:</span> <span class="s">master-svc</span>
  <span class="s">cron.tab</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">*/30 * * * * ntpdate master-svc &amp;&amp; hwclock --systohc</span>

  <span class="s">config.ini</span><span class="pi">:</span> <span class="pi">|-</span>
    <span class="s">[General]</span>
    <span class="s"># Hostname of the CM server.</span>
    <span class="s">server_host=master-svc</span>

    <span class="s"># Port that the CM server is listening on.</span>
    <span class="s">server_port=7182</span>

    <span class="s">## It should not normally be necessary to modify these.</span>
    <span class="s"># Port that the CM agent should listen on.</span>
    <span class="s"># listening_port=9000</span>

    <span class="s"># IP Address that the CM agent should listen on.</span>
    <span class="s"># listening_ip=</span>

    <span class="s"># Hostname that the CM agent reports as its hostname. If unset, will be</span>
    <span class="s"># obtained in code through something like this:</span>
    <span class="s">#</span>
    <span class="s">#   python -c 'import socket; \</span>
    <span class="s">#              print socket.getfqdn(), \</span>
    <span class="s">#                    socket.gethostbyname(socket.getfqdn())'</span>
    <span class="s">#</span>
    <span class="s"># listening_hostname=</span>

    <span class="s"># An alternate hostname to report as the hostname for this host in CM.</span>
    <span class="s"># Useful when this agent is behind a load balancer or proxy and all</span>
    <span class="s"># inbound communication must connect through that proxy.</span>
    <span class="s"># reported_hostname=</span>

    <span class="s"># Port that supervisord should listen on.</span>
    <span class="s"># NB: This only takes effect if supervisord is restarted.</span>
    <span class="s"># supervisord_port=19001</span>

    <span class="s"># Log file.  The supervisord log file will be placed into</span>
    <span class="s"># the same directory.  Note that if the agent is being started via the</span>
    <span class="s"># init.d script, /var/log/cloudera-scm-agent/cloudera-scm-agent.out will</span>
    <span class="s"># also have a small amount of output (from before logging is initialized).</span>
    <span class="s"># log_file=/var/log/cloudera-scm-agent/cloudera-scm-agent.log</span>

    <span class="s"># Persistent state directory.  Directory to store CM agent state that</span>
    <span class="s"># persists across instances of the agent process and system reboots.</span>
    <span class="s"># Particularly, the agent's UUID is stored here.</span>
    <span class="s"># lib_dir=/var/lib/cloudera-scm-agent</span>

    <span class="s"># Parcel directory.  Unpacked parcels will be stored in this directory.</span>
    <span class="s"># Downloaded parcels will be stored in &lt;parcel_dir&gt;/../parcel-cache</span>
    <span class="s"># parcel_dir=/opt/cloudera/parcels</span>

    <span class="s"># Enable supervisord event monitoring.  Used in eager heartbeating, amongst</span>
    <span class="s"># other things.</span>
    <span class="s"># enable_supervisord_events=true</span>

    <span class="s"># Maximum time to wait (in seconds) for all metric collectors to finish</span>
    <span class="s"># collecting data.</span>
    <span class="s">max_collection_wait_seconds=10.0</span>

    <span class="s"># Maximum time to wait (in seconds) when connecting to a local role's</span>
    <span class="s"># webserver to fetch metrics.</span>
    <span class="s">metrics_url_timeout_seconds=30.0</span>

    <span class="s"># Maximum time to wait (in seconds) when connecting to a local TaskTracker</span>
    <span class="s"># to fetch task attempt data.</span>
    <span class="s">task_metrics_timeout_seconds=5.0</span>

    <span class="s"># The list of non-device (nodev) filesystem types which will be monitored.</span>
    <span class="s">monitored_nodev_filesystem_types=nfs,nfs4,tmpfs</span>

    <span class="s"># The list of filesystem types which are considered local for monitoring purposes.</span>
    <span class="s"># These filesystems are combined with the other local filesystem types found in</span>
    <span class="s"># /proc/filesystems</span>
    <span class="s">local_filesystem_whitelist=ext2,ext3,ext4,xfs</span>

    <span class="s"># The largest size impala profile log bundle that this agent will serve to the</span>
    <span class="s"># CM server. If the CM server requests more than this amount, the bundle will</span>
    <span class="s"># be limited to this size. All instances of this limit being hit are logged to</span>
    <span class="s"># the agent log.</span>
    <span class="s">impala_profile_bundle_max_bytes=1073741824</span>

    <span class="s"># The largest size stacks log bundle that this agent will serve to the CM</span>
    <span class="s"># server. If the CM server requests more than this amount, the bundle will be</span>
    <span class="s"># limited to this size. All instances of this limit being hit are logged to the</span>
    <span class="s"># agent log.</span>
    <span class="s">stacks_log_bundle_max_bytes=1073741824</span>

    <span class="s"># The size to which the uncompressed portion of a stacks log can grow before it</span>
    <span class="s"># is rotated. The log will then be compressed during rotation.</span>
    <span class="s">stacks_log_max_uncompressed_file_size_bytes=5242880</span>

    <span class="s"># The orphan process directory staleness threshold. If a diretory is more stale</span>
    <span class="s"># than this amount of seconds, CM agent will remove it.</span>
    <span class="s">orphan_process_dir_staleness_threshold=5184000</span>

    <span class="s"># The orphan process directory refresh interval. The CM agent will check the</span>
    <span class="s"># staleness of the orphan processes config directory every this amount of</span>
    <span class="s"># seconds.</span>
    <span class="s">orphan_process_dir_refresh_interval=3600</span>

    <span class="s"># A knob to control the agent logging level. The options are listed as follows:</span>
    <span class="s"># 1) DEBUG (set the agent logging level to 'logging.DEBUG')</span>
    <span class="s"># 2) INFO (set the agent logging level to 'logging.INFO')</span>
    <span class="s">scm_debug=INFO</span>

    <span class="s"># The DNS resolution collecion interval in seconds. A java base test program</span>
    <span class="s"># will be executed with at most this frequency to collect java DNS resolution</span>
    <span class="s"># metrics. The test program is only executed if the associated health test,</span>
    <span class="s"># Host DNS Resolution, is enabled.</span>
    <span class="s">dns_resolution_collection_interval_seconds=60</span>

    <span class="s"># The maximum time to wait (in seconds) for the java test program to collect</span>
    <span class="s"># java DNS resolution metrics.</span>
    <span class="s">dns_resolution_collection_timeout_seconds=30</span>

    <span class="s"># The directory location in which the agent-wide kerberos credential cache</span>
    <span class="s"># will be created.</span>
    <span class="s"># agent_wide_credential_cache_location=/var/run/cloudera-scm-agent</span>

    <span class="s">[Security]</span>
    <span class="s"># Use TLS and certificate validation when connecting to the CM server.</span>
    <span class="s">use_tls=0</span>

    <span class="s"># The maximum allowed depth of the certificate chain returned by the peer.</span>
    <span class="s"># The default value of 9 matches the default specified in openssl's</span>
    <span class="s"># SSL_CTX_set_verify.</span>
    <span class="s">max_cert_depth=9</span>

    <span class="s"># A file of CA certificates in PEM format. The file can contain several CA</span>
    <span class="s"># certificates identified by</span>
    <span class="s">#</span>
    <span class="s"># -----BEGIN CERTIFICATE-----</span>
    <span class="s"># ... (CA certificate in base64 encoding) ...</span>
    <span class="s"># -----END CERTIFICATE-----</span>
    <span class="s">#</span>
    <span class="s"># sequences. Before, between, and after the certificates text is allowed which</span>
    <span class="s"># can be used e.g. for descriptions of the certificates.</span>
    <span class="s">#</span>
    <span class="s"># The file is loaded once, the first time an HTTPS connection is attempted. A</span>
    <span class="s"># restart of the agent is required to pick up changes to the file.</span>
    <span class="s">#</span>
    <span class="s"># Note that if neither verify_cert_file or verify_cert_dir is set, certificate</span>
    <span class="s"># verification will not be performed.</span>
    <span class="s"># verify_cert_file=</span>

    <span class="s"># Directory containing CA certificates in PEM format. The files each contain one</span>
    <span class="s"># CA certificate. The files are looked up by the CA subject name hash value,</span>
    <span class="s"># which must hence be available. If more than one CA certificate with the same</span>
    <span class="s"># name hash value exist, the extension must be different (e.g. 9d66eef0.0,</span>
    <span class="s"># 9d66eef0.1 etc). The search is performed in the ordering of the extension</span>
    <span class="s"># number, regardless of other properties of the certificates. Use the c_rehash</span>
    <span class="s"># utility to create the necessary links.</span>
    <span class="s">#</span>
    <span class="s"># The certificates in the directory are only looked up when required, e.g. when</span>
    <span class="s"># building the certificate chain or when actually performing the verification</span>
    <span class="s"># of a peer certificate. The contents of the directory can thus be changed</span>
    <span class="s"># without an agent restart.</span>
    <span class="s">#</span>
    <span class="s"># When looking up CA certificates, the verify_cert_file is first searched, then</span>
    <span class="s"># those in the directory. Certificate matching is done based on the subject name,</span>
    <span class="s"># the key identifier (if present), and the serial number as taken from the</span>
    <span class="s"># certificate to be verified. If these data do not match, the next certificate</span>
    <span class="s"># will be tried. If a first certificate matching the parameters is found, the</span>
    <span class="s"># verification process will be performed; no other certificates for the same</span>
    <span class="s"># parameters will be searched in case of failure.</span>
    <span class="s">#</span>
    <span class="s"># Note that if neither verify_cert_file or verify_cert_dir is set, certificate</span>
    <span class="s"># verification will not be performed.</span>
    <span class="s"># verify_cert_dir=</span>

    <span class="s"># PEM file containing client private key.</span>
    <span class="s"># client_key_file=</span>

    <span class="s"># A command to run which returns the client private key password on stdout</span>
    <span class="s"># client_keypw_cmd=</span>

    <span class="s"># If client_keypw_cmd isn't specified, instead a text file containing</span>
    <span class="s"># the client private key password can be used.</span>
    <span class="s"># client_keypw_file=</span>

    <span class="s"># PEM file containing client certificate.</span>
    <span class="s"># client_cert_file=</span>

    <span class="s">## Location of Hadoop files.  These are the CDH locations when installed by</span>
    <span class="s">## packages.  Unused when CDH is installed by parcels.</span>
    <span class="s">[Hadoop]</span>
    <span class="s">#cdh_crunch_home=/usr/lib/crunch</span>
    <span class="s">#cdh_flume_home=/usr/lib/flume-ng</span>
    <span class="s">#cdh_hadoop_bin=/usr/bin/hadoop</span>
    <span class="s">#cdh_hadoop_home=/usr/lib/hadoop</span>
    <span class="s">#cdh_hbase_home=/usr/lib/hbase</span>
    <span class="s">#cdh_hbase_indexer_home=/usr/lib/hbase-solr</span>
    <span class="s">#cdh_hcat_home=/usr/lib/hive-hcatalog</span>
    <span class="s">#cdh_hdfs_home=/usr/lib/hadoop-hdfs</span>
    <span class="s">#cdh_hive_home=/usr/lib/hive</span>
    <span class="s">#cdh_httpfs_home=/usr/lib/hadoop-httpfs</span>
    <span class="s">#cdh_hue_home=/usr/share/hue</span>
    <span class="s">#cdh_hue_plugins_home=/usr/lib/hadoop</span>
    <span class="s">#cdh_impala_home=/usr/lib/impala</span>
    <span class="s">#cdh_llama_home=/usr/lib/llama</span>
    <span class="s">#cdh_mr1_home=/usr/lib/hadoop-0.20-mapreduce</span>
    <span class="s">#cdh_mr2_home=/usr/lib/hadoop-mapreduce</span>
    <span class="s">#cdh_oozie_home=/usr/lib/oozie</span>
    <span class="s">#cdh_parquet_home=/usr/lib/parquet</span>
    <span class="s">#cdh_pig_home=/usr/lib/pig</span>
    <span class="s">#cdh_solr_home=/usr/lib/solr</span>
    <span class="s">#cdh_spark_home=/usr/lib/spark</span>
    <span class="s">#cdh_sqoop_home=/usr/lib/sqoop</span>
    <span class="s">#cdh_sqoop2_home=/usr/lib/sqoop2</span>
    <span class="s">#cdh_yarn_home=/usr/lib/hadoop-yarn</span>
    <span class="s">#cdh_zookeeper_home=/usr/lib/zookeeper</span>
    <span class="s">#hive_default_xml=/etc/hive/conf.dist/hive-default.xml</span>
    <span class="s">#webhcat_default_xml=/etc/hive-webhcat/conf.dist/webhcat-default.xml</span>
    <span class="s">#jsvc_home=/usr/libexec/bigtop-utils</span>
    <span class="s">#tomcat_home=/usr/lib/bigtop-tomcat</span>
    <span class="s">#oracle_home=/usr/share/oracle/instantclient</span>

    <span class="s">## Location of Cloudera Management Services files.</span>
    <span class="s">[Cloudera]</span>
    <span class="s">#mgmt_home=/usr/share/cmf</span>

    <span class="s">## Location of JDBC Drivers.</span>
    <span class="s">[JDBC]</span>
    <span class="s">cloudera_mysql_connector_jar=/usr/java/latest/mysql-connector-java.jar</span>
    <span class="s">#cloudera_oracle_connector_jar=/usr/share/java/oracle-connector-java.jar</span>
    <span class="s">#By default, postgres jar is found dynamically in $MGMT_HOME/lib</span>
    <span class="s">#cloudera_postgresql_jdbc_jar=</span>
<span class="s">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nfs-deploy</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">cloudera</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">nfs</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">revisionHistoryLimit</span><span class="pi">:</span> <span class="m">2</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">nfs</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">nfs-client</span>
      <span class="na">namespace</span><span class="pi">:</span> <span class="s">cloudera</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">nfs</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">tolerations</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">node-role.kubernetes.io/master</span>
        <span class="na">effect</span><span class="pi">:</span> <span class="s">NoSchedule</span>
      <span class="na">serviceAccountName</span><span class="pi">:</span> <span class="s">cloudera-sa</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">registry.cn-hangzhou.aliyuncs.com/acs/alicloud-nas-controller:v1.8.4</span>
<span class="c1">#        imagePullPolicy: Never</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">nfs-client</span>
<span class="c1">#        securityContext:</span>
<span class="c1">#          privileged: true</span>
        <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">nfs-client-root</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/persistentvolumes</span>
        <span class="na">env</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">PROVISIONER_NAME</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">alicloud/nas</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">NFS_SERVER</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">074ca49d80-ak47.cn-hangzhou.nas.aliyuncs.com</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">NFS_PATH</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s">/pv/cloudera/agent/</span>
      <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">nfs-client-root</span>
        <span class="na">nfs</span><span class="pi">:</span>
          <span class="na">server</span><span class="pi">:</span> <span class="s">074ca49d80-ak47.cn-hangzhou.nas.aliyuncs.com</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/pv/cloudera/agent/</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">storage.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">StorageClass</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">cloudera-storage</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">cloudera</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">storage</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
<span class="na">reclaimPolicy</span><span class="pi">:</span> <span class="s">Delete</span>
<span class="na">provisioner</span><span class="pi">:</span> <span class="s">alicloud/nas</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">master-deploy</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">cloudera</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">master-deploy</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">revisionHistoryLimit</span><span class="pi">:</span> <span class="m">2</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">master</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">master</span>
      <span class="na">namespace</span><span class="pi">:</span> <span class="s">cloudera</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">master</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">tolerations</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">effect</span><span class="pi">:</span> <span class="s">NoSchedule</span>
        <span class="na">key</span><span class="pi">:</span> <span class="s">node-role.kubernetes.io/master</span>
      <span class="na">restartPolicy</span><span class="pi">:</span> <span class="s">Always</span>
      <span class="na">serviceAccountName</span><span class="pi">:</span> <span class="s">cloudera-sa</span>
      <span class="na">automountServiceAccountToken</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">hostname</span><span class="pi">:</span> <span class="s">master-svc</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">cloudera-master</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">registry-vpc.cn-hangzhou.aliyuncs.com/huaching_prod/cloudera-master:5.14.2</span>
<span class="c1">#        imagePullPolicy: IfNotPresent</span>
        <span class="na">resources</span><span class="pi">:</span>
          <span class="na">limits</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">4096Mi"</span>
            <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1000m"</span>
        <span class="na">lifecycle</span><span class="pi">:</span>
          <span class="na">preStop</span><span class="pi">:</span>
            <span class="na">exec</span><span class="pi">:</span>
              <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">/bin/bash"</span><span class="pi">,</span><span class="s2">"</span><span class="s">-c"</span><span class="pi">,</span><span class="s2">"</span><span class="s">/cloudera-init/run/stop.sh</span><span class="nv"> </span><span class="s">&gt;&gt;</span><span class="nv"> </span><span class="s">/cloudera/log/stop.log</span><span class="nv"> </span><span class="s">2&gt;&amp;1"</span><span class="pi">]</span>
        <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="c1">#- name: cloudera-init</span>
          <span class="c1">#mountPath: /cloudera-init/run/</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mysql</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/var/lib/mysql/</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">repo</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/opt/cloudera/parcel-repo/</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/opt/cm/etc/cloudera-scm-agent/</span>
        <span class="na">env</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">HOSTNAME</span>
          <span class="na">valueFrom</span><span class="pi">:</span>
            <span class="na">configMapKeyRef</span><span class="pi">:</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">cloudera-config</span>
              <span class="na">key</span><span class="pi">:</span> <span class="s">master_host</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">POD_IP</span>
          <span class="na">valueFrom</span><span class="pi">:</span>
            <span class="na">fieldRef</span><span class="pi">:</span>
              <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
              <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">status.podIP</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">POD_NAME</span>
          <span class="na">valueFrom</span><span class="pi">:</span>
            <span class="na">fieldRef</span><span class="pi">:</span>
              <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
              <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">metadata.name</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">7180</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">ui</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">9000</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">agent</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">7182</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">server</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">7191</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">parcel</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">4434</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">parcel-ssl</span>
        <span class="na">securityContext</span><span class="pi">:</span>
          <span class="na">privileged</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">imagePullSecrets</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">registrykey-vpc</span>
      <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">repo</span>
        <span class="na">nfs</span><span class="pi">:</span>
          <span class="na">server</span><span class="pi">:</span> <span class="s">074ca49d80-ak47.cn-hangzhou.nas.aliyuncs.com</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/pv/cloudera/repo/</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mysql</span>
        <span class="na">nfs</span><span class="pi">:</span>
          <span class="na">server</span><span class="pi">:</span> <span class="s">074ca49d80-ak47.cn-hangzhou.nas.aliyuncs.com</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/pv/cloudera/master/</span>
      <span class="c1">#- name: cloudera-init</span>
        <span class="c1">#configMap:</span>
          <span class="c1">#name: cloudera-config</span>
          <span class="c1">#defaultMode: 0751</span>
          <span class="c1">#items:</span>
          <span class="c1">#- key: master.start</span>
            <span class="c1">#path: start.sh</span>
          <span class="c1">#- key: master.stop</span>
            <span class="c1">#path: stop.sh</span>
          <span class="c1">#- key: mysql.sql</span>
            <span class="c1">#path: mysql.sql</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
        <span class="na">configMap</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">cloudera-config</span>
          <span class="na">items</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">config.ini</span>
            <span class="na">path</span><span class="pi">:</span> <span class="s">config.ini</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">master-svc</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">cloudera</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">master-svc</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
<span class="na">spec</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">ClusterIP</span>
    <span class="na">clusterIP</span><span class="pi">:</span> <span class="s">None</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">agent</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">9000</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">9000</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">server</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">7182</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">7182</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">parcel</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">7191</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">7191</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">parcel-ssl</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">4434</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">4434</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ui</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">7180</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">7180</span>
    <span class="na">selector</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">master</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">master-external</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">cloudera</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">master-external</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
<span class="na">spec</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">ClusterIP</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ui</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">7180</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">7180</span>
    <span class="na">selector</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">master</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">policy/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PodDisruptionBudget</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">agent-pdb</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">cloudera</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">agent-pdb</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">agent</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
  <span class="na">maxUnavailable</span><span class="pi">:</span> <span class="m">1</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">agent-svc</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">cloudera</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">agent-svc</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
<span class="na">spec</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">ClusterIP</span>
    <span class="na">clusterIP</span><span class="pi">:</span> <span class="s">None</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">agent</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">9000</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">9000</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">server</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">7182</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">7182</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">parcel</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">7191</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">7191</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">parcel-ssl</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">4434</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">4434</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">parcel-ssl2</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">4433</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">4433</span>
    <span class="na">selector</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">agent</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">StatefulSet</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">agent</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">cloudera</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">agent-sts</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">agent</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
  <span class="na">serviceName</span><span class="pi">:</span> <span class="s">agent-svc</span>
  <span class="na">updateStrategy</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">RollingUpdate</span>
  <span class="na">podManagementPolicy</span><span class="pi">:</span> <span class="s">OrderedReady</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">3</span>
  <span class="na">revisionHistoryLimit</span><span class="pi">:</span> <span class="m">2</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">cagent</span>
      <span class="na">namespace</span><span class="pi">:</span> <span class="s">cloudera</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">agent</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">cloudera</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">tolerations</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">effect</span><span class="pi">:</span> <span class="s">NoSchedule</span>
        <span class="na">key</span><span class="pi">:</span> <span class="s">node-role.kubernetes.io/master</span>
      <span class="na">restartPolicy</span><span class="pi">:</span> <span class="s">Always</span>
      <span class="na">serviceAccountName</span><span class="pi">:</span> <span class="s">cloudera-sa</span>
      <span class="na">automountServiceAccountToken</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">agent</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">registry-vpc.cn-hangzhou.aliyuncs.com/huaching_prod/cloudera-node:5.14.2</span>
<span class="c1">#        imagePullPolicy: IfNotPresent</span>
        <span class="na">resources</span><span class="pi">:</span>
          <span class="na">limits</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">4096Mi"</span>
            <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1000m"</span>
        <span class="na">lifecycle</span><span class="pi">:</span>
          <span class="na">preStop</span><span class="pi">:</span>
            <span class="na">exec</span><span class="pi">:</span>
              <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">/bin/bash"</span><span class="pi">,</span><span class="s2">"</span><span class="s">-c"</span><span class="pi">,</span><span class="s2">"</span><span class="s">/cloudera-init/run/stop.sh"</span><span class="pi">]</span>
        <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">repo</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/opt/cloudera/parcel-repo/</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">lib</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/opt/cm/lib/cloudera-scm-agent/</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/opt/cm/etc/cloudera-scm-agent/</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">9000</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">agent</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">7182</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">server</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">7191</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">parcel</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">4434</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">parcel-ssl</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">4433</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">parcel-ssl2</span>
        <span class="na">securityContext</span><span class="pi">:</span>
          <span class="na">privileged</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">imagePullSecrets</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">registrykey-vpc</span>
      <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
        <span class="na">configMap</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">cloudera-config</span>
          <span class="na">items</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">config.ini</span>
            <span class="na">path</span><span class="pi">:</span> <span class="s">config.ini</span>
          <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">cron.tab</span>
            <span class="na">path</span><span class="pi">:</span> <span class="s">cron.tab</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">repo</span>
        <span class="na">nfs</span><span class="pi">:</span>
          <span class="na">server</span><span class="pi">:</span> <span class="s">074ca49d80-ak47.cn-hangzhou.nas.aliyuncs.com</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/pv/cloudera/repo/</span>
  <span class="na">volumeClaimTemplates</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">lib</span>
      <span class="na">namespace</span><span class="pi">:</span> <span class="s">cloudera</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="c1">#volumeName: lib</span>
      <span class="na">volumeMode</span><span class="pi">:</span> <span class="s">Filesystem</span>
      <span class="na">accessModes</span><span class="pi">:</span> <span class="pi">[</span> <span class="s2">"</span><span class="s">ReadWriteOnce"</span> <span class="pi">]</span>
      <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">cloudera-storage</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">requests</span><span class="pi">:</span>
          <span class="na">storage</span><span class="pi">:</span> <span class="s">20Gi</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">cdh-master-ing</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">cloudera</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">host</span><span class="pi">:</span> <span class="s">cdh.docs.aliyun.com</span>
    <span class="na">http</span><span class="pi">:</span>
      <span class="na">paths</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">backend</span><span class="pi">:</span>
          <span class="na">serviceName</span><span class="pi">:</span> <span class="s">master-external</span>
          <span class="na">servicePort</span><span class="pi">:</span> <span class="m">7180</span>

</code></pre></div></div>

<h2 id="注意事项">注意事项</h2>
<ul>
  <li>创建<code class="language-plaintext highlighter-rouge">namespace cloudera</code></li>
  <li>镜像来源已经在上方说明了,可以自己去<code class="language-plaintext highlighter-rouge">rebuild</code></li>
  <li>默认全部不会启动<code class="language-plaintext highlighter-rouge">command脚本可以看出</code></li>
  <li>启动流程进入<code class="language-plaintext highlighter-rouge">Master-deploy </code> 去执行<code class="language-plaintext highlighter-rouge">start.sh</code>启动，根据机器情况，启动时间不等，期间可以用<code class="language-plaintext highlighter-rouge">netstat -tlunp</code> 查看端口是否占用来验证启动成功与否.</li>
  <li><code class="language-plaintext highlighter-rouge">CDH</code> 需要用到Kubernetes的<code class="language-plaintext highlighter-rouge">特权模式</code>,相关细节请查关键字 <code class="language-plaintext highlighter-rouge">Kubernetes securityContext</code></li>
  <li>
    <p>部分界面如下：
<img src="http://112firshme11224.test.upcdn.net/demos/2f2be0a5-ef33-4458-9cd4-433b9a3ebed4.png" alt="" /></p>
  </li>
  <li>
    <p>服务界面</p>

    <p><img src="http://112firshme11224.test.upcdn.net/demos/3596a98d-8de0-4641-b2b6-e7904061479d.png" alt="" /></p>
  </li>
  <li>
    <p>PVC 界面</p>

    <p><img src="http://112firshme11224.test.upcdn.net/demos/e68c1177-32c0-419b-8acd-eeecbfd702dc.png" alt="" /></p>
  </li>
  <li>
    <p>CDH 节点界面</p>

    <p><img src="http://112firshme11224.test.upcdn.net/demos/49f7fc4a-2f25-4895-818a-0e6d296983b0.png" alt="" /></p>
  </li>
  <li>节点服务运行情况。
  <img src="http://112firshme11224.test.upcdn.net/demos/a054ea06-ffcb-4340-bfc9-7b307d7cbc99.png" alt="" /></li>
</ul>

<h3 id="感谢-httpsgithubcomwindawings">感谢 https://github.com/windawings</h3>

<p>转载请注明出处，本文采用 <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">CC4.0</a> 协议授权</p>

    </article>
    <div class="share">
      <div class="share-component"></div>
    </div>
    <div class="comment">
      
  
        <div id="gitalk-container"></div>
        <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
        <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
        <script>
        var gitalk = new Gitalk({
            id: '/2018/09/20/kubernetes-cdh-deploy/',
            clientID: '0dc80b46a482ec78f3e0',
            clientSecret: '8cae5d306b3703ad240b74142995473086fcbbab',
            repo: 'blog-comments',
            owner: 'uk0',
            admin: ['uk0'],
            labels: ['gitment'],
            perPage: 50,
        })
        gitalk.render('gitalk-container')
        </script>
      <!-- 多说公共JS代码 END -->
      <!-- Duoshuo Comment END -->
  


    </div>
  </div>
  <div class="column one-fourth">
    <h3>Affiliate</h3>
<a href="https://www.vultr.com/?ref=7142633"><img src="https://www.vultr.com/media/banner_3.png" width="300" height="250"></a>

<h3>Search</h3>
<div id="site_search">
    <input type="text" id="search_box" placeholder="Search">
    <button class="btn btn-default" id="site_search_do"><span class="octicon octicon-search"></span></button>
</div>

<ul id="search_results"></ul>

<link rel="stylesheet" type="text/css" href="http://112firshme11224.test.upcdn.net/assets/css/modules/sidebar-search.css">
<script src="http://112firshme11224.test.upcdn.net/assets/js/lunr.min.js"></script>
<script src="http://112firshme11224.test.upcdn.net/assets/js/search.js"></script>


    
<h3>Post Directory</h3>
<div id="post-directory-module" class="mobile-hidden">
  <section class="post-directory">
  <!-- Links that trigger the jumping -->
  <!-- Added by javascript below -->
  <dl></dl>
  </section>
</div>
<script src="http://112firshme11224.test.upcdn.net/assets/js/jquery.toc.js"></script>

  </div>
</div>
</section>
<!-- /section.content -->

    <footer class="container">
        <div class="site-footer" role="contentinfo">
            <div class="copyright left mobile-block">
                    © 2015
                    <span title="ZhangJianXin">ZhangJianXin</span>
                    <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a>
            </div>

            <ul class="site-footer-links right mobile-hidden">
                <li>
                    <a href="javascript:window.scrollTo(0,0)" >TOP</a>
                </li>
            </ul>
            <a href="https://github.com/uk0/uk0.github.io" target="_blank" aria-label="view source code">
                <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
            </a>
            <ul class="site-footer-links mobile-hidden">
                
                <li>
                    <a href="/" title="首页" target="">首页</a>
                </li>
                
                <li>
                    <a href="/categories/" title="分类" target="">分类</a>
                </li>
                
                <li>
                    <a href="/wiki/" title="维基" target="">维基</a>
                </li>
                
                <li>
                    <a href="/links/" title="链接" target="">链接</a>
                </li>
                
                <li>
                    <a href="/about/" title="关于" target="">关于</a>
                </li>
                
                <li><a href="/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li>
            </ul>

        </div>
    </footer>
    <!-- / footer -->
    <script src="http://112firshme11224.test.upcdn.net/assets/vendor/share.js/dist/js/share.min.js"></script>
    <script src="http://112firshme11224.test.upcdn.net/assets/js/geopattern.js"></script>
    <script src="http://112firshme11224.test.upcdn.net/assets/js/prism.js"></script>
    <link rel="stylesheet" href="http://112firshme11224.test.upcdn.net/assets/css/globals/prism.css">
    <script>
      jQuery(document).ready(function($) {
        // geopattern
        $('.geopattern').each(function(){
          $(this).geopattern($(this).data('pattern-id'));
        });
       // hljs.initHighlightingOnLoad();
      });
    </script>
    
    <div style="display:none">
      <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130872028-1"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-130872028-1');
        </script>
    </div>
    
</body>
    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>
</html>
